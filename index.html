<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Путь Парламентера - Полная версия</title>
    <style>
        /* Стили остаются без изменений */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
            background: linear-gradient(to bottom, #1a0a0e, #2d1a25);
            color: #e8d8c3;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.1"><path d="M20,20 Q50,5 80,20 T100,50 T80,80 T50,100 T20,80 T0,50 T20,20 Z" fill="none" stroke="%23d4af37" stroke-width="2"/></svg>');
            background-size: 120px 120px;
        }
        
        .game-container {
            max-width: 900px;
            width: 100%;
            background: #1e1218;
            border: 3px solid #8a5a44;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.7);
            overflow: hidden;
            position: relative;
        }
        
        .header {
            background: linear-gradient(to right, #5e2a2a, #8a4a4a);
            padding: 25px;
            text-align: center;
            border-bottom: 3px solid #d4af37;
            position: relative;
        }
        
        .header h1 {
            color: #f7e9d0;
            font-size: 36px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
            letter-spacing: 2px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .header h2 {
            color: #d4c0a0;
            font-size: 20px;
            font-style: italic;
            margin-top: 5px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }
        
        .stats-container {
            display: flex;
            justify-content: space-around;
            background: #2a1e25;
            padding: 15px;
            border-bottom: 2px solid #5a3a3a;
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
            padding: 8px;
            position: relative;
        }
        
        .stat-label {
            font-size: 16px;
            color: #c0b060;
            margin-bottom: 8px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #d4af37;
            text-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
        }
        
        .meter {
            height: 10px;
            background: #1a1015;
            border: 1px solid #5a4a3a;
            border-radius: 5px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .meter-fill {
            height: 100%;
            transition: width 0.7s ease-out;
        }
        
        .trust-meter .meter-fill {
            background: linear-gradient(to right, #2a5a2a, #4a9a4a);
        }
        
        .anger-meter .meter-fill {
            background: linear-gradient(to right, #7a2a2a, #c05a5a);
        }
        
        .honor-meter .meter-fill {
            background: linear-gradient(to right, #2a4a7a, #4a7ac0);
        }
        
        .scene-container {
            padding: 30px;
            min-height: 400px;
            background: #1a1015 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><rect x="10" y="10" width="80" height="80" fill="none" stroke="%238a7a5a" stroke-width="1"/></svg>');
            position: relative;
            overflow: hidden;
        }
        
        .scene-title {
            color: #d4af37;
            font-size: 28px;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px dashed #8a5a44;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
        }
        
        .scene-text {
            font-size: 19px;
            margin-bottom: 30px;
            text-align: justify;
            line-height: 1.8;
            background: rgba(30, 20, 25, 0.7);
            padding: 20px;
            border-radius: 8px;
            border-left: 3px solid #d4af37;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .choices-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .choice-btn {
            background: linear-gradient(to right, #3a2a2a, #5a3a3a);
            color: #f0e0c0;
            border: 1px solid #8a7a5a;
            padding: 16px 25px;
            font-size: 18px;
            cursor: pointer;
            text-align: left;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
            border-radius: 5px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }
        
        .choice-btn:hover {
            background: linear-gradient(to right, #4a3a3a, #7a5a5a);
            border-color: #d4af37;
            transform: translateX(10px);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }
        
        .choice-btn.danger:hover {
            background: linear-gradient(to right, #7a2a2a, #9a4a4a);
            box-shadow: 0 0 15px rgba(255, 50, 50, 0.5);
        }
        
        .choice-btn:before {
            content: "⚔️";
            margin-right: 12px;
            color: #d4af37;
            font-size: 20px;
        }
        
        .final-container {
            text-align: center;
            padding: 40px 30px;
            background: rgba(20, 10, 15, 0.9);
            border-radius: 10px;
            margin: 20px;
            border: 2px solid #8a5a44;
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.5);
        }
        
        .final-title {
            color: #d4af37;
            font-size: 36px;
            margin-bottom: 30px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.8);
            font-weight: bold;
        }
        
        .final-text {
            font-size: 22px;
            margin-bottom: 40px;
            line-height: 1.8;
            background: rgba(40, 20, 30, 0.6);
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #d4af37;
        }
        
        .restart-btn {
            background: linear-gradient(to right, #5e2a2a, #8a4a4a);
            color: #f7e9d0;
            border: 2px solid #d4af37;
            padding: 18px 50px;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.4s;
            border-radius: 8px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }
        
        .restart-btn:hover {
            background: linear-gradient(to right, #7a3a3a, #aa5a5a);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.7);
        }
        
        .corner-decoration {
            position: absolute;
            width: 50px;
            height: 50px;
            border: 2px solid #8a7a5a;
        }
        
        .top-left {
            top: 15px;
            left: 15px;
            border-right: none;
            border-bottom: none;
        }
        
        .top-right {
            top: 15px;
            right: 15px;
            border-left: none;
            border-bottom: none;
        }
        
        .bottom-left {
            bottom: 15px;
            left: 15px;
            border-right: none;
            border-top: none;
        }
        
        .bottom-right {
            bottom: 15px;
            right: 15px;
            border-left: none;
            border-top: none;
        }
        
        .faction-icon {
            position: absolute;
            opacity: 0.15;
            font-size: 150px;
            z-index: 0;
            pointer-events: none;
        }
        
        .faction-icon.left {
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .faction-icon.right {
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .death-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            color: #c00;
            text-align: center;
            padding: 20px;
            font-size: 24px;
        }
        
        .death-title {
            font-size: 48px;
            margin-bottom: 30px;
            color: #f00;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
        }
        
        .death-text {
            font-size: 28px;
            margin-bottom: 40px;
            max-width: 800px;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .game-container {
                padding: 10px;
            }
            
            .scene-text {
                font-size: 17px;
                padding: 15px;
            }
            
            .choice-btn {
                padding: 14px 20px;
                font-size: 16px;
            }
            
            .stat-value {
                font-size: 20px;
            }
            
            .header h1 {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="corner-decoration top-left"></div>
        <div class="corner-decoration top-right"></div>
        <div class="corner-decoration bottom-left"></div>
        <div class="corner-decoration bottom-right"></div>
        
        <div class="header">
            <h1>ПУТЬ ПАРЛАМЕНТЕРА</h1>
            <h2>Полная версия со всеми 52 сценами и 25 концовками</h2>
        </div>
        
        <div class="stats-container">
            <div class="stat-item">
                <div class="stat-label">ДОВЕРИЕ</div>
                <div class="stat-value" id="trust-value">50</div>
                <div class="meter trust-meter">
                    <div class="meter-fill" id="trust-meter" style="width: 50%"></div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-label">ГНЕВ</div>
                <div class="stat-value" id="anger-value">50</div>
                <div class="meter anger-meter">
                    <div class="meter-fill" id="anger-meter" style="width: 50%"></div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-label">ЧЕСТЬ</div>
                <div class="stat-value" id="honor-value">50</div>
                <div class="meter honor-meter">
                    <div class="meter-fill" id="honor-meter" style="width: 50%"></div>
                </div>
            </div>
        </div>
        
        <div class="scene-container">
            <div class="faction-icon left">⚔️</div>
            <div class="faction-icon right">🛡️</div>
            
            <div class="scene-title" id="scene-title">Ворота Лагеря Герцога</div>
            <div class="scene-text" id="scene-text">
                Вы, барон фон Драк, подъезжаете к укрепленному лагерю герцога Альбана. Ваша миссия - добиться перемирия для вашего сюзерена, графа фон Вальдена. Стража преграждает путь. Капитан, воин со шрамом через лицо, требует назвать ваше имя и цель. В лагере слышны крики тренирующихся солдат и лязг оружия. Вы замечаете недовольные взгляды некоторых воинов - возможно, среди них есть те, кто недоволен правлением герцога.
            </div>
            <div class="choices-container" id="choices-container">
                <button class="choice-btn" data-choice="1">«Я барон фон Драк, парламентер графа фон Вальдена! Требую аудиенции у герцога!»</button>
                <button class="choice-btn" data-choice="2">«Мир вам, капитан. Я барон фон Драк, посол графа. Прошу аудиенции у его светлости.»</button>
                <button class="choice-btn" data-choice="3">Молча протянуть свиток с печатью графа и гербом парламентера</button>
                <button class="choice-btn" data-choice="4">Шепнуть капитану: «Я могу сделать тебя богатым, если поможешь мне обойти герцога...»</button>
                <button class="choice-btn danger" data-choice="5">Напасть на капитана стражи, попытавшись прорваться силой</button>
                <button class="choice-btn" data-choice="6">«Капитан, я заметил недовольство в рядах ваших воинов. Может, стоит поговорить?»</button>
            </div>
        </div>
    </div>

    <script>
        // Расширенное состояние игры
        const gameState = {
            trust: 50,
            anger: 50,
            honor: 50,
            currentScene: "start",
            concessions: 0,
            flags: {
                insultedGuard: false,
                showedDocument: false,
                mentionedKingsPeace: false,
                offeredHostages: false,
                invokedFounders: false,
                revealedSecret: false,
                bribedCaptain: false,
                startedMutiny: false,
                sabotagedCamp: false
            }
        };

        // Полный набор сцен с концовками
        const scenes = {
            start: {
                title: "Ворота Лагеря Герцога",
                text: "Вы, барон фон Драк, подъезжаете к укрепленному лагерю герцога Альбана. Ваша миссия - добиться перемирия для вашего сюзерена, графа фон Вальдена. Стража преграждает путь. Капитан, воин со шрамом через лицо, требует назвать ваше имя и цель. В лагере слышны крики тренирующихся солдат и лязг оружия. Вы замечаете недовольные взгляды некоторых воинов - возможно, среди них есть те, кто недоволен правлением герцога.",
                choices: [
                    { 
                        text: "«Я барон фон Драк, парламентер графа фон Вальдена! Требую аудиенции у герцога!»", 
                        next: "gate_arrogant",
                        effect: { anger: 10, honor: -5 }
                    },
                    { 
                        text: "«Мир вам, капитан. Я барон фон Драк, посол графа. Прошу аудиенции у его светлости.»", 
                        next: "gate_polite",
                        effect: { trust: 5, honor: 5 }
                    },
                    { 
                        text: "Молча протянуть свиток с печатью графа и гербом парламентера", 
                        next: "gate_document",
                        effect: { trust: 10 },
                        setFlag: "showedDocument"
                    },
                    { 
                        text: "Шепнуть капитану: «Я могу сделать тебя богатым, если поможешь мне обойти герцога...»", 
                        next: "gate_bribe",
                        effect: { honor: -20 },
                        setFlag: "bribedCaptain"
                    },
                    { 
                        text: "Напасть на капитана стражи, попытавшись прорваться силой", 
                        next: "death_guard_attack",
                        effect: { anger: 100 }
                    },
                    { 
                        text: "«Капитан, я заметил недовольство в рядах ваших воинов. Может, стоит поговорить?»", 
                        next: "gate_mutiny",
                        effect: { trust: 5, honor: -10 },
                        setFlag: "startedMutiny"
                    }
                ]
            },
            
            death_game_error: {
        title: "Неизведанный Путь",
        text: "К сожалению, в этом месте вашего пути произошла неожиданная ошибка. Разработчики уже работают над исправлением этой ветки сюжета. Пожалуйста, примите наши извинения - вы стали первопроходцем на этом пути! Ваш выбор будет тщательно проработан в ближайшем обновлении игры.",
        choices: [],
        final: true,
        death: true,
        ending: "Путь в разработке"
    },
            
            // Ветка подкупа
            gate_bribe: {
                title: "Опасный Подкуп",
                text: "Капитан наклоняется ближе, его глаза сужаются. «Богатым, говоришь? - он оглядывается по сторонам. - Герцог платит нам гроши, а воевать заставляет каждый сезон. Сколько предлагаешь?» Его рука небрежно лежит на рукояти меча.",
                choices: [
                    { 
                        text: "«500 ДСМ сейчас и еще 500, когда перемирие будет достигнуто.»", 
                        next: "bribe_offer",
                        effect: { trust: 10, honor: -15 }
                    },
                    { 
                        text: "«1000 ДСМ сейчас, и должность в замке графа после войны.»", 
                        next: "bribe_generous",
                        effect: { trust: 15, honor: -20 }
                    },
                    { 
                        text: "«Золото? У меня есть нечто ценнее - координаты бункера с технологиями Основателей.»", 
                        next: "bribe_tech",
                        effect: { trust: 20, honor: -25 }
                    },
                    { 
                        text: "Передумать: «Забудь, что я сказал. Просто проведи меня к герцогу.»", 
                        next: "gate_polite",
                        effect: { anger: 20, trust: -10 }
                    }
                ]
            },
            
            bribe_offer: {
                title: "Сделка с Дьяволом",
                text: "«500 сейчас? - капитан усмехается. - Это цена одной моей сапоги, барон. Но... - он понижает голос. - Я знаю людей, которые не прочь сместить герцога. За 2000 ДСМ я могу устроить «несчастный случай» до завтрашнего рассвета.»",
                choices: [
                    { 
                        text: "Согласиться на предложение капитана", 
                        next: "mutiny_plan",
                        effect: { honor: -30 },
                        setFlag: "startedMutiny"
                    },
                    { 
                        text: "«Я дам 1000 сейчас, остальное после.»", 
                        next: "bribe_partial",
                        effect: { trust: 15, honor: -20 }
                    },
                    { 
                        text: "«Это слишком! Я просто хочу переговоров!»", 
                        next: "bribe_refused",
                        effect: { anger: 30, trust: -20 }
                    },
                    { 
                        text: "Достать кинжал и попытаться убить капитана", 
                        next: "death_bribe_fail",
                        effect: { anger: 100 }
                    }
                ]
            },
            
            bribe_partial: {
                title: "Частичная Оплата",
                text: "Капитан берет мешочек с золотом и взвешивает его в руке. «Тысяча сейчас... ладно. Но помни - остальное я получу, когда герцог будет мертв.» Он делает знак стражникам пропустить вас. «Жди сигнала у дуба на востоке лагеря. Когда увидишь огонь - действуй.»",
                choices: [
                    { 
                        text: "Следовать плану капитана", 
                        next: "mutiny_plan",
                        effect: { trust: 10 }
                    },
                    { 
                        text: "Попытаться найти других союзников в лагере", 
                        next: "death_allies_fail",
                        effect: { trust: 5, honor: -10 }
                    },
                    { 
                        text: "Передумать и пойти к герцогу", 
                        next: "gate_arrogant",
                        effect: { anger: 40, honor: -30 }
                    }
                ]
            },
            
            bribe_refused: {
                title: "Отказ от Сделки",
                text: "«Просто переговоров? - капитан смеется. - Ты уже предложил мне золото за предательство, барон!» Он делает знак стражникам. «Возьмите его! Этот посол - предатель и подстрекатель!» Вас хватают и уводят в темницу. Ваша миссия провалена.",
                choices: [
                    { 
                        text: "Попытаться подкупить стражников", 
                        next: "death_bribe_guards",
                        effect: { honor: -20 }
                    },
                    { 
                        text: "Попытаться сбежать", 
                        next: "death_prison_escape",
                        effect: { anger: 20 }
                    },
                    { 
                        text: "Ждать суда", 
                        next: "prison_trial",
                        effect: { trust: -10 }
                    }
                ]
            },
            
            prison_trial: {
                title: "Суд Герцога",
                text: "На следующий день вас выводят к герцогу. «Так это ты хотел подкупить моих людей? - говорит он холодно. - За это полагается смерть. Но если назовешь имена всех сообщников, я могу быть милосерден.»",
                choices: [
                    { 
                        text: "Назвать капитана как главного заговорщика", 
                        next: "death_trial",
                        effect: { honor: -50 }
                    },
                    { 
                        text: "Молчать и сохранить честь", 
                        next: "death_trial",
                        effect: { honor: 20 }
                    },
                    { 
                        text: "«Я действовал по приказу графа!»", 
                        next: "death_trial",
                        effect: { trust: -30 }
                    }
                ]
            },
            
            // Ветка мятежа
            mutiny_plan: {
                title: "Заговор",
                text: "Капитан кивает: «Жди сигнала у дуба на востоке лагеря. Когда увидишь огонь над шатром герцога - действуй.» Он незаметно забирает мешочек с золотом. Ночью вы пробираетесь к условленному месту. Внезапно раздаются крики и звуки борьбы из центра лагеря.",
                choices: [
                    { 
                        text: "Броситься на помощь мятежникам", 
                        next: "mutiny_join",
                        effect: { honor: -40 }
                    },
                    { 
                        text: "Попытаться поджечь склад с припасами", 
                        next: "sabotage_success",
                        effect: { honor: -35 },
                        setFlag: "sabotagedCamp"
                    },
                    { 
                        text: "Оставаться в укрытии и наблюдать", 
                        next: "mutiny_fail",
                        effect: { anger: 30 }
                    },
                    { 
                        text: "Попытаться убить герцога в суматохе", 
                        next: "death_duke_attack",
                        effect: { anger: 100 }
                    }
                ]
            },
            
            mutiny_join: {
                title: "Кровавый Мятеж",
                text: "Вы бросаетесь в гущу схватки. Лагерь превратился в ад - повсюду крики, звон мечей и запах крови. Вы видите, как капитан сражается с личной гвардией герцога. Внезапно из темноты появляется сам герцог в полном вооружении!",
                choices: [
                    { 
                        text: "Атаковать герцога вместе с капитаном", 
                        next: "mutiny_success"
                    },
                    { 
                        text: "Попытаться поджечь шатер герцога", 
                        next: "sabotage_success"
                    },
                    { 
                        text: "Спасти капитана от нападающих гвардейцев", 
                        next: "mutiny_captain_saved"
                    },
                    { 
                        text: "Попытаться бежать из лагеря", 
                        next: "death_escape_fail"
                    }
                ]
            },
            
            mutiny_captain_saved: {
                title: "Долг Чести",
                text: "Вы бросаетесь на помощь капитану, отбивая атаку гвардейцев. Вместе вы отступаете к баррикадам мятежников. Капитан, раненый, но живой, хватает вас за плечо: «Вы спасли мне жизнь, барон! Теперь моя честь обязывает меня помочь вам!» Он собирает оставшихся верных людей.",
                choices: [
                    { 
                        text: "Контратаковать с новыми силами", 
                        next: "mutiny_counter_attack"
                    },
                    { 
                        text: "Прорываться к воротам лагеря", 
                        next: "mutiny_escape"
                    },
                    { 
                        text: "Искать укрытие для перевязки капитана", 
                        next: "death_hideout"
                    }
                ]
            },
            
            mutiny_counter_attack: {
                title: "Последний Бросок",
                text: "Собрав последние силы, вы ведете мятежников в контратаку. Герцог, уверенный в победе, не ожидал такого сопротивления. В жестокой схватке вам удается пробиться к его шатру.",
                choices: [
                    { 
                        text: "Предложить герцогу почетную сдату", 
                        next: "duke_surrender_offer"
                    },
                    { 
                        text: "Штурмовать шатер герцога", 
                        next: "duke_death"
                    }
                ]
            },
            
            duke_surrender_offer: {
                title: "Переговоры в Огне",
                text: "«Ваша светлость! - кричите вы. - Ваша гвардия разбита, лагерь горит! Сдайтесь, и мы гарантируем вам жизнь!» Герцог появляется в дверях шатра, его доспехи в крови. «Жизнь? - он горько смеется. - Я предпочитаю смерть позору!» Он бросается в последнюю атаку.",
                choices: [
                    { 
                        text: "Принять вызов герцога", 
                        next: "duel_with_duke"
                    },
                    { 
                        text: "Приказать лучникам стрелять", 
                        next: "duke_death"
                    }
                ]
            },
            
            duel_with_duke: {
                title: "Последний Поединок",
                text: "Вы принимаете вызов герцога. «По чести, один на один!» - объявляете вы. Бой жесток и краток. Герцог - опытный воин, но раны и возраст берут свое. Ваш клинок находит щель в его доспехах.",
                choices: [
                    { 
                        text: "Добить герцога", 
                        next: "duke_death"
                    },
                    { 
                        text: "Пощадить поверженного врага", 
                        next: "duke_spared"
                    }
                ]
            },
            
            duke_spared: {
                title: "Концовка: Милосердие Победителя",
                text: "Вы стоите над поверженным герцогом. «Сдайтесь, ваша светлость. Ваша жизнь будет сохранена.» Герцог, истекая кровью, кивает. «Вы... победили...» С его капитуляцией мятеж превращается в революцию. Вы возвращаетесь к графу как герой, а капитан становится новым правителем земель герцога. Ваше милосердие принесло вам уважение даже среди врагов.",
                choices: [],
                final: true,
                ending: "Победа с честью"
            },
            
            duke_death: {
                title: "Концовка: Падение Герцога",
                text: "Вы наносите последний удар, и герцог падает замертво. «Герцог мертв! - кричите вы. - Сопротивление бесполезно!» Оставшиеся гвардейцы бросают оружие. Капитан провозглашает вас героем мятежа. Вы возвращаетесь к графу с триумфом, но знаете, что эта победа куплена ценой чести и предательства.",
                choices: [],
                final: true,
                ending: "Трон крови"
            },
            
            mutiny_escape: {
                title: "Побег из Лагеря",
                text: "С помощью капитана вы пробиваетесь к воротам лагеря. «Лошадей там! - кричит он. - Уходите, барон! Я прикрою ваш отход!» Вы видите, как герцогова гвардия приближается.",
                choices: [
                    { 
                        text: "Убегать одному", 
                        next: "escape_alone"
                    },
                    { 
                        text: "Забрать раненого капитана с собой", 
                        next: "escape_with_captain"
                    }
                ]
            },
            
            escape_with_captain: {
                title: "Концовка: Братство по Оружию",
                text: "Вы втаскиваете раненого капитана на лошадь и прорываетесь через ворота. Позади слышны крики преследователей. Через несколько часов вы добираетесь до замка графа. Капитан становится ценным союзником, а его знания о герцоге помогают вашему сюзерену выиграть войну. Хотя мятеж провалился, вы обрели верного друга и соратника.",
                choices: [],
                final: true,
                ending: "Братство по оружию"
            },
            
            // Опасные и гибельные сцены
            death_guard_attack: {
                title: "Бесчестная Гибель",
                text: "Вы внезапно хватаетесь за меч и бросаетесь на капитана стражи. Тот, опытный воин, легко парирует ваш удар. «Предатель!» - кричит он. Десяток стражников окружает вас. Вы отчаянно сражаетесь, но силы неравны. Последнее, что вы видите - стальной клинок, направленный вам в горло.",
                choices: [],
                final: true,
                death: true,
                ending: "Смерть у ворот"
            },
            
            death_bribe_fail: {
                title: "Цена Предательства",
                text: "Вы пытаетесь убить капитана, но тот оказывается быстрее. Его клинок пронзает вашу грудь. «Жалкий предатель, - слышите вы его голос. - Я служу герцогу верой и правдой!» Вы падаете на землю, истекая кровью, в то время как стражники добивают вас.",
                choices: [],
                final: true,
                death: true,
                ending: "Смерть предателя"
            },
            
            death_duke_attack: {
                title: "Безумная Атака",
                text: "Вы пробиваетесь к шатру герцога и врываетесь внутрь. Герцог, опытный воин, мгновенно реагирует на угрозу. Ваш удар не достигает цели, а его меч пронзает ваше горло. «Последний посол предателя, - слышите вы его голос. - Такая же жалкая смерть ждет и твоего господина.»",
                choices: [],
                final: true,
                death: true,
                ending: "Гибель в шатре герцога"
            },
            
            death_insult: {
                title: "Смертельное Оскорбление",
                text: "Ваш плевок попадает герцогу прямо в лицо. На мгновение воцарилась мертвая тишина. Затем герцог медленно вытирает лицо. Без единого слова он делает жест рукой. Стража хватает вас. «Завтра на рассвете казнить как предателя. Пусть его голова украсит ворота лагеря.» Вас уводят в темницу, где вы проводите последнюю ночь перед казнью.",
                choices: [],
                final: true,
                death: true,
                ending: "Казнь за оскорбление"
            },
            
            death_escape_fail: {
                title: "Провал Побега",
                text: "Вы пытаетесь бежать, но путь перекрыт. Гвардейцы герцога окружают вас. «Предатель! - кричит их командир. - Ты заплатишь за мятеж!» Вас хватают и волокут к позорному столбу. На рассвете герцог лично отрубает вам голову, а ваши останки отправляют вашему сюзерену как предупреждение.",
                choices: [],
                final: true,
                death: true,
                ending: "Позорная казнь"
            },
            
            // Обычные переговоры - агрессивная ветка
            gate_arrogant: {
                title: "Вызов Герцогу",
                text: "Капитан хмуро смотрит на вас: «Требуете, барон? Здесь не замок вашего графа. Ждите у ворот.» Проходит час. Наконец, вас проводят в шатер. Герцог Альбан не предлагает сесть. «Граф-предатель прислал парламентера? Говорите быстро.»",
                choices: [
                    { 
                        text: "«Ваша светлость, граф просит перемирия. Он готов дать заложников!»", 
                        next: "tent_arrogant_hostages",
                        effect: { anger: 5 }
                    },
                    { 
                        text: "«Герцог, ваши войска истощены. Перемирие выгодно вам больше, чем графу!»", 
                        next: "tent_arrogant_threat",
                        effect: { anger: 20, trust: -10 }
                    },
                    { 
                        text: "«Я прибыл говорить о мире во имя Основателей.»", 
                        next: "tent_arrogant_faith",
                        effect: { honor: 10, anger: 5 }
                    },
                    { 
                        text: "Достать спрятанный клинок и напасть на герцога", 
                        next: "death_duke_attack",
                        effect: { anger: 100 }
                    },
                    { 
                        text: "Плюнуть герцогу в лицо: «Ты не лучше предателя!»", 
                        next: "death_insult",
                        effect: { anger: 100 }
                    }
                ]
            },
            
            tent_arrogant_hostages: {
                title: "Переговоры о Заложниках",
                text: "«Заложников? - усмехается герцог. - Того мальчишку, что прячется за юбками матери? Он мне не нужен. Ваш граф лишен чести, барон.» В шатер входят два воина, становясь по бокам от вас.",
                choices: [
                    { 
                        text: "«Тогда возьмите меня как заложника, ваша светлость. Мой род не запятнан предательством.»", 
                        next: "response_self_hostage"
                    },
                    { 
                        text: "«Граф готов передать вам чертежи ветроагрегатов из бункера Основателей.»", 
                        next: "response_tech_concession"
                    },
                    { 
                        text: "«Если не перемирие, то хотя бы трое суток для эвакуации женщин и детей. По законам войны!»", 
                        next: "response_evacuation"
                    }
                ]
            },
            
            tent_arrogant_threat: {
                title: "Опасная Угроза",
                text: "Герцог вскакивает: «Ты смеешь угрожать мне?! Мои войска готовы сокрушить замок твоего господина за три дня!» Он хватает меч. «Стража! Возьмите этого наглеца!»",
                choices: [
                    { 
                        text: "Попытаться объяснить свои слова", 
                        next: "arrogant_threat_explain"
                    },
                    { 
                        text: "Извиниться и просить прощения", 
                        next: "arrogant_threat_apology"
                    },
                    { 
                        text: "Достать оружие и сражаться", 
                        next: "death_duke_attack"
                    }
                ]
            },
            
            arrogant_threat_explain: {
                title: "Концовка: Слишком Поздно",
                text: "«Ваша светлость, я не хотел...» - начинаете вы, но герцог машет рукой. «Мне надоели ваши оправдания!» Он приказывает заключить вас в темницу. Через три дня, после взятия замка вашего сюзерена, вас казнят как военного преступника.",
                choices: [],
                final: true,
                death: true,
                ending: "Казнь за дерзость"
            },
            
            arrogant_threat_apology: {
                title: "Концовка: Унизительное Извинение",
                text: "Вы падаете на колени: «Простите, ваша светлость! Я говорил глупости!» Герцог смотрит на вас с презрением. «Ваша трусость оскорбляет память ваших предков. Убирайтесь из моего лагеря и передайте графу - у него осталось три дня до штурма.» Вы покидаете лагерь униженным, но живым.",
                choices: [],
                final: true,
                ending: "Позорное отступление"
            },
            
            tent_arrogant_faith: {
                title: "Имя Основателей",
                text: "Герцог хмурится: «Основателей? Не смеши меня. Твой граф нарушил все клятвы, данные на Схеме Предков. Почему я должен слушать тебя?»",
                choices: [
                    { 
                        text: "«Потому что даже в войне должны быть пределы, установленные Основателями.»", 
                        next: "arrogant_faith_argument"
                    },
                    { 
                        text: "«Граф готов принести искупительную жертву в Храме Основателей.»", 
                        next: "arrogant_faith_sacrifice"
                    },
                    { 
                        text: "«Я принес священную реликвию Основателей как гарант мирных намерений.»", 
                        next: "arrogant_faith_relic"
                    }
                ]
            },
            
            arrogant_faith_argument: {
                title: "Концовка: Священные Законы",
                text: "Герцог задумывается: «Законы Основателей... Да, они священны.» Он кивает. «Хорошо. Трое суток перемирия для эвакуации невинных. Но предупреди графа - если после этого срока в замке будет хоть один солдат, я начну штурм без пощады.» Вы с облегчением выдыхаете - хоть и частично, но миссия выполнена.",
                choices: [],
                final: true,
                ending: "Мир по Законам"
            },
            
            arrogant_faith_sacrifice: {
                title: "Концовка: Кровавая Жертва",
                text: "«Искупительная жертва? - переспрашивает герцог. - Хм... Это может вернуть расположение Основателей.» Он протягивает пергамент. «Десять дней перемирия. Но если жертва не будет принесена - война продолжится с удвоенной яростью.» Вы возвращаетесь с тяжелым сердцем, зная, что ваш сюзерен должен будет пожертвовать кем-то из близких.",
                choices: [],
                final: true,
                ending: "Мир кровью"
            },
            
            arrogant_faith_relic: {
                title: "Концовка: Священная Реликвия",
                text: "Герцог с благоговением берет реликвию: «Фрагмент Схемы Основателей... Как он попал к вашему графу?» Он долго разглядывает артефакт. «Хорошо. Двадцать дней перемирия в знак уважения к Основателям. Но предупредите графа - если он нарушит перемирие, я уничтожу его род до последнего младенца.»",
                choices: [],
                final: true,
                ending: "Мир через Реликвию"
            },
            
            response_self_hostage: {
                title: "Концовка: Заложник Собственной Чести",
                text: "Герцог смотрит на вас с неожиданным уважением: «Вы предлагаете себя в заложники? Смело... Глупо, но смело.» Он делает знак страже. «Отведите барона в палатку для гостей. Пусть граф знает - если через десять дней замок не сдастся, я казню его посла.» Вы становитесь пленником, но ваша честь остается неприкосновенной. Перемирие достигнуто, но ценой вашей свободы.",
                choices: [],
                final: true,
                ending: "Пленник чести"
            },
            
            response_tech_concession: {
                title: "Концовка: Технологическая Измена",
                text: "Глаза герцога загораются жадным блеском: «Чертежи ветроагрегатов?.. Это меняет дело.» Он протягивает пергамент. «Вот условия: перемирие на двадцать дней, а чертежи - немедленно!» Вы выполняете приказ, но позже узнаете, что эти технологии попали в руки еретиков. Хотя ваша миссия успешна, Церковь Основателей объявляет вас предателем веры.",
                choices: [],
                final: true,
                ending: "Пиррова победа"
            },
            
            response_evacuation: {
                title: "Концовка: Милосердие Герцога",
                text: "Герцог задумывается: «Женщины и дети... Да, законы войны священны.» Он кивает. «Трое суток. Но если после этого срока в замке останется хоть один солдат, я начну штурм без пощады.» Вы с облегчением выдыхаете - миссия выполнена, хоть и частично. Семьи ваших воинов будут спасены, но война продолжится.",
                choices: [],
                final: true,
                ending: "Частичный успех"
            },
            
            // Вежливая ветка
            gate_polite: {
                title: "Путь к Шатру",
                text: "Капитан кивает: «Ждите, барон. Доложу его светлости.» Через полчаса вас проводят в шатер. Герцог Альбан изучает карту. «Граф фон Вальден прислал вас? Смело. После нарушения вассальной клятвы?»",
                choices: [
                    { 
                        text: "«Ваша светлость, граф просит перемирия на тридцать дней. Он готов дать заложников в знак доброй воли.»", 
                        next: "tent_polite_hostages",
                        effect: { anger: 5 }
                    },
                    { 
                        text: "«Герцог, перемирие даст время вашим войскам отдохнуть, а графу - подготовить условия капитуляции.»", 
                        next: "tent_polite_clever",
                        effect: { trust: 10 }
                    },
                    { 
                        text: "«Я прошу аудиенции под знаменем парламентера, ваша светлость. По законам чести, вы обязаны меня выслушать.»", 
                        next: "tent_polite_honor",
                        effect: { honor: 15, anger: 10 }
                    }
                ]
            },
            
            tent_polite_hostages: {
                title: "Переговоры в Шатре",
                text: "Герцог откладывает карту: «Заложников? Он и мне клялся на Житие Основателей! Что помешает ему нарушить клятву снова?» Его взгляд становится холодным.",
                choices: [
                    { 
                        text: "«На этот раз клятву принесу я лично. Мой род не запятнан предательством.»", 
                        next: "response_honor_oath"
                    },
                    { 
                        text: "«Граф готов передать вам ключи от восточных башен и выплатить 2000 ДСМ контрибуции.»", 
                        next: "response_generous_concession"
                    },
                    { 
                        text: "«Ваша светлость, я знаю о планах ваших врагов в Совете Герцогов. Дам эту информацию в обмен на перемирие.»", 
                        next: "response_intrigue"
                    }
                ]
            },
            
            response_honor_oath: {
                title: "Концовка: Клятва на Житии",
                text: "«Клятву на Житии Основателей? - переспрашивает герцог. - Это серьезно.» Он встает. «Хорошо, барон. Принесите клятву здесь, перед моими капитанами.» Вы кладете руку на Схему Основателей и клянетесь в верности условиям. Герцог удовлетворенно кивает: «Тридцать дней перемирия. Но помните - нарушение этой клятвы погубит не только графа, но и ваш род.»",
                choices: [],
                final: true,
                ending: "Клятва на Святыне"
            },
            
            response_generous_concession: {
                title: "Концовка: Щедрые Уступки",
                text: "«Ключи от башен и 2000 ДСМ? - удивленно поднимает бровь герцог. - Ваш граф стал неожиданно щедр.» Он подписывает пергамент. «Перемирие на сорок дней. Но предупредите графа - если он попытается вернуть башни, я сотру его замок с лица земли.» Вы покидаете лагерь с чувством выполненного долга, хотя цена оказалась высокой.",
                choices: [],
                final: true,
                ending: "Дорогой мир"
            },
            
            response_intrigue: {
                title: "Концовка: Игры Власти",
                text: "«Информация о моих врагах? - задумчиво говорит герцог. - Это... интересно.» Он делает знак писцу. «Перемирие на тридцать дней в обмен на ваши сведения. Но если информация окажется ложной - ваша голова украсит ворота моего замка.» Вы выполняете договоренность, но понимаете, что втянули свой дом в опасную политическую игру.",
                choices: [],
                final: true,
                ending: "Опасные знания"
            },
            
            tent_polite_clever: {
                title: "Хитроумный Подход",
                text: "Герцог усмехается: «Подготовить условия капитуляции? Твой граф всегда был хитер.» Он изучает вас пристальным взглядом. «Что он действительно предлагает?»",
                choices: [
                    { 
                        text: "«Полную капитуляцию в обмен на сохранение жизни его семьи.»", 
                        next: "response_surrender_family"
                    },
                    { 
                        text: "«Отвод войск на север и выплату контрибуции.»", 
                        next: "response_withdrawal_tribute"
                    },
                    { 
                        text: "«Союз против общего врага - герцога Вольфрама.»", 
                        next: "response_alliance_wolfram"
                    }
                ]
            },
            
            response_surrender_family: {
                title: "Концовка: Семейная Капитуляция",
                text: "«Сохранить жизнь семье? - переспрашивает герцог. - Это разумно.» Он подписывает пергамент. «Пусть граф сложит оружие до завтрашнего рассвета. Его семья будет сохранена, но он отправится в изгнание.» Вы возвращаетесь с тяжелым сердцем, зная, что ваш сюзерен потеряет все, но его близкие будут спасены.",
                choices: [],
                final: true,
                ending: "Спасение семьи"
            },
            
            response_withdrawal_tribute: {
                title: "Концовка: Стратегический Отход",
                text: "«Отвод войск и контрибуция? - задумчиво говорит герцог. - Это может быть приемлемо.» Он подписывает пергамент. «Пятнадцать дней на отвод войск и 5000 ДСМ контрибуции. Но если хоть одно условие не будет выполнено - война продолжится.» Вы покидаете лагерь с чувством выполненного долга, хотя цена оказалась высокой.",
                choices: [],
                final: true,
                ending: "Дорогая передышка"
            },
            
            response_alliance_wolfram: {
                title: "Концовка: Союз против Вольфрама",
                text: "Герцог поднимает бровь: «Против Вольфрама? Этот выскочка действительно стал проблемой.» Он протягивает пергамент. «Перемирие на шестьдесят дней. Если ваш граф поможет мне разбить Вольфрама, я прощу его предательство.» Вы с облегчением киваете - миссия выполнена, и возможно, ваш сюзерен обрел могущественного союзника.",
                choices: [],
                final: true,
                ending: "Тактический альянс"
            },
            
            tent_polite_honor: {
                title: "Зов Чести",
                text: "Герцог хмурится: «Законы чести? Твой господин забыл о них, когда нарушил вассальную клятву!» Однако после паузы он кивает. «Но ты прав - знамя парламентера священно. Говори.»",
                choices: [
                    { 
                        text: "«Граф предлагает суд старейшин для разрешения конфликта.»", 
                        next: "response_elders_court"
                    },
                    { 
                        text: "«Граф готов лично принести извинения перед вами на рыночной площади.»", 
                        next: "response_public_apology"
                    },
                    { 
                        text: "«Граф передаст вам своего первого сына как гаранта мирных намерений.»", 
                        next: "response_eldest_son"
                    }
                ]
            },
            
            response_elders_court: {
                title: "Концовка: Суд Старейшин",
                text: "«Суд старейшин? - задумчиво говорит герцог. - Это древняя традиция... Хорошо, я согласен.» Он дает вам охранную грамоту. «Через десять дней в нейтральном городе. Но предупреди графа - если он не явится, война продолжится.» Вы возвращаетесь с надеждой на мирное решение конфликта.",
                choices: [],
                final: true,
                ending: "Путь традиций"
            },
            
            response_public_apology: {
                title: "Концовка: Публичное Унижение",
                text: "«Извинения на рыночной площади? - усмехается герцог. - Да, это восстановит мою честь.» Он подписывает пергамент. «Пусть граф явится без оружия, в рубище, с веревкой на шее. Если он выполнит ритуал - перемирие на тридцать дней.» Вы возвращаетесь, зная что ваш сюзерен будет унижен, но война будет остановлена.",
                choices: [],
                final: true,
                ending: "Цена достоинства"
            },
            
            response_eldest_son: {
                title: "Концовка: Залог Крови",
                text: "«Первый сын? - переспрашивает герцог. - Серьезный залог.» Он кивает. «Хорошо. Пусть мальчик будет воспитываться в моем замке. Если граф не нарушит перемирие в течение года - сын вернется к нему.» Вы соглашаетесь, зная что стали причиной разлуки отца и сына, но мир достигнут.",
                choices: [],
                final: true,
                ending: "Заложник крови"
            },
            
            // Концовка для ветки документов
            gate_document: {
                title: "По Документам",
                text: "Капитан внимательно изучает печать, кивает: «Печать подлинная. Проводите барона.» Герцог встречает вас стоя. «Барон фон Драк? Я помню вашего отца. Он был честным воином. Надеюсь, вы не запятнали его чести.»",
                choices: [
                    { 
                        text: "«Ваша светлость, граф просит перемирия. Он готов дать заложников - своего сына и племянника.»", 
                        next: "tent_document_hostages"
                    },
                    { 
                        text: "«Герцог, я прибыл предложить путь к миру. Перемирие - первый шаг к прекращению кровопролития.»", 
                        next: "tent_document_peace"
                    },
                    { 
                        text: "«Граф готов сдать замок и признать ваше превосходство в обмен на свободный выход для своей семьи.»", 
                        next: "tent_document_surrender"
                    }
                ]
            },
            
            tent_document_hostages: {
                title: "Переговоры о Заложниках",
                text: "Герцог внимательно изучает документы: «Сын и племянник? - он задумчиво постукивает пальцами по столу. - Ваш граф предлагает серьезный залог. Но почему я должен верить предателю?»",
                choices: [
                    { 
                        text: "«Как гарантию, граф готов немедленно отвести войска от речной переправы.»", 
                        next: "response_strategic_concession"
                    },
                    { 
                        text: "«Я останусь здесь как гарант выполнения условий, ваша светлость. Мой чести достаточно?»", 
                        next: "response_personal_guarantee"
                    },
                    { 
                        text: "«Граф передаст вам часть запасов вилладиума в качестве залога.»", 
                        next: "response_villadium_concession"
                    }
                ]
            },
            
            response_strategic_concession: {
                title: "Концовка: Стратегическая Победа",
                text: "«Отвод войск от переправы? - удивлен герцог. - Это... неожиданно.» Он подходит к карте. «Хорошо, перемирие на двадцать дней. Но если к вечеру войска не отойдут, соглашение аннулируется.» Вы немедленно отправляете гонца. Миссия выполнена, а ваш сюзерен получает стратегическую передышку.",
                choices: [],
                final: true,
                ending: "Тактический триумф"
            },
            
            response_personal_guarantee: {
                title: "Концовка: Честь как Залог",
                text: "Герцог долго смотрит на вас: «Личная гарантия барона фон Драка... Это стоит многого.» Он протягивает пергамент. «Тридцать дней перемирия. Но вы останетесь здесь как гость моего дома. Надеюсь, честь вашего рода не пострадает.» Вы соглашаетесь, зная что стали заложником, но мир достигнут.",
                choices: [],
                final: true,
                ending: "Заложник чести"
            },
            
            response_villadium_concession: {
                title: "Концовка: Дорогой Вилладиум",
                text: "«Вилладиум? - глаза герцога загораются. - Твой граф предлагает редкий ресурс.» Он подписывает пергамент. «Десять дней перемирия за каждую бочку вилладиума. Но если качество окажется низким - соглашение аннулируется.» Вы выполняете условия, зная что ваш сюзерен отдал стратегический ресурс, но мир достигнут.",
                choices: [],
                final: true,
                ending: "Ресурсный компромисс"
            },
            
            tent_document_peace: {
                title: "Путь к Миру",
                text: "Герцог откладывает карту: «Прекращение кровопролития? После того как твой господин нарушил клятву? Что он предлагает для восстановления доверия?»",
                choices: [
                    { 
                        text: "«Граф готов выплатить компенсацию пострадавшим семьям.»", 
                        next: "response_compensation"
                    },
                    { 
                        text: "«Граф откажется от спорных территорий в вашу пользу.»", 
                        next: "response_territory_concession"
                    },
                    { 
                        text: "«Граф предоставит вам доступ к архивам Основателей в своем замке.»", 
                        next: "response_archives_access"
                    }
                ]
            },
            
            response_compensation: {
                title: "Концовка: Кровные Деньги",
                text: "«Компенсация? - переспрашивает герцог. - Это может успокоить моих людей.» Он подписывает пергамент. «3000 ДСМ для семей погибших и тридцать дней перемирия.» Вы возвращаетесь, зная что ваш сюзерен заплатил высокую цену, но война остановлена.",
                choices: [],
                final: true,
                ending: "Мир за золото"
            },
            
            response_territory_concession: {
                title: "Концовка: Территориальные Уступки",
                text: "«Спорные территории? - удивлен герцог. - Твой граф всегда был жаден до земли.» Он изучает карту. «Хорошо, перемирие на сорок дней. Но если к концу срока документы о передаче не будут подписаны - война продолжится.»",
                choices: [],
                final: true,
                ending: "Мир через земли"
            },
            
            response_archives_access: {
                title: "Концовка: Знания Основателей",
                text: "«Архивы Основателей? - заинтересованно говорит герцог. - Да, это стоит многого.» Он подписывает пергамент. «Перемирие на шестьдесят дней. Мои ученые получат полный доступ к архивам. Но предупреди графа - если хоть один свиток будет поврежден, я сожгу его замок.»",
                choices: [],
                final: true,
                ending: "Мир за знания"
            },
            
            tent_document_surrender: {
                title: "Концовка: Почетная Сдача",
                text: "Герцог долго смотрит на вас: «Свободный выход для семьи? - он задумчиво постукивает пальцами по столу. - Хорошо. Пусть граф сложит оружие и выйдет с семьей до завтрашнего рассвета. Его жизни и чести ничего не угрожает.» Вы склоняете голову: «Благодарю, ваша светлость. Граф примет ваши условия.» Миссия выполнена - война окончена, хотя и ценой замка вашего сюзерена.",
                choices: [],
                final: true,
                ending: "Мир через сдачу"
            },
            
            // Концовки мятежа
            mutiny_success: {
                title: "Концовка: Трон Крови",
                text: "Вместе с капитаном вы сражаетесь против герцога. В жестокой схватке вам удается одолеть его. Капитан поднимает окровавленный меч герцога: «Лагерь наш! Герцог мертв!» Мятежники ликуют. Капитан назначает вас своим советником. Вы возвращаетесь к графу с вестью о победе, но знаете, что эта победа куплена ценой чести и предательства.",
                choices: [],
                final: true,
                ending: "Победа ценой чести"
            },
            
            sabotage_success: {
                title: "Концовка: Огненная Диверсия",
                text: "Пока мятежники отвлекают стражу, вы поджигаете склады с припасами. Огненное зарево освещает ночь. В суматохе вам удается бежать. Вернувшись к графу, вы докладываете: «Армия герцога лишена продовольствия и боеприпасов. Теперь он не сможет осаждать наш замок!» Ваш сюзерен доволен, но шепчет советнику: «Такой человек опасен...»",
                choices: [],
                final: true,
                ending: "Успех диверсии"
            },
            
            // Дополнительные концовки
            escape_alone: {
                title: "Концовка: Одинокий Беглец",
                text: "Вы бросаете капитана и в одиночку прорываетесь через ворота. Позади слышны крики погони. Вы добираетесь до замка графа, но без капитана ваша информация неполна. Граф разочарован, но признает ваши усилия. Вы остаетесь в живых, но ваша репутация запятнана бегством.",
                choices: [],
                final: true,
                ending: "Бегство ценой чести"
            },
            
            death_bribe_guards: {
                title: "Цена Двойного Предательства",
                text: "Вы пытаетесь подкупить стражников, но они лишь смеются: «Нас уже предупредили о твоем золоте, предатель.» Они забирают ваши деньги и избивают вас. На следующий день вас казнят как предателя.",
                choices: [],
                final: true,
                death: true,
                ending: "Казнь в темнице"
            },
            
            death_prison_escape: {
                title: "Провал Побега",
                text: "Вы пытаетесь сбежать, но стража начеку. Вас ловят в коридоре темницы и жестоко избивают. На рассвете герцог лично отрубает вам голову, а ваше тело вывешивают на стенах лагеря как предупреждение другим предателям.",
                choices: [],
                final: true,
                death: true,
                ending: "Проваленный побег"
            },
            
            death_trial: {
                title: "Смертный Приговор",
                text: "Герцог хмуро смотрит на вас: «Ты исчерпал мое терпение.» Он делает знак палачу. «Казнить предателя!» Вас уводят на плаху. Последнее, что вы видите - топор палача, сверкающий в утреннем солнце.",
                choices: [],
                final: true,
                death: true,
                ending: "Казнь за предательство"
            },
            
            mutiny_fail: {
                title: "Провал Мятежа",
                text: "Вы остаетесь в укрытии, пока мятежники сражаются. Без вашей поддержки мятеж быстро подавляют. Герцог, узнав о вашем участии, приказывает казнить вас на рассвете. Ваша миссия завершается позорной смертью.",
                choices: [],
                final: true,
                death: true,
                ending: "Позорная смерть"
            },
            
            death_allies_fail: {
                title: "Предательство в Лагере",
                text: "Пытаясь найти союзников, вы неосторожно доверяетесь не тем людям. Один из солдат докладывает о вас капитану гвардии. Вас хватают и приводят к герцогу, который приговаривает вас к немедленной казни за подстрекательство к мятежу.",
                choices: [],
                final: true,
                death: true,
                ending: "Казнь за мятеж"
            },
            
            death_hideout: {
                title: "Ловушка в Укрытии",
                text: "Пока вы перевязываете капитана, гвардейцы герцога окружают ваше укрытие. «Выходите с поднятыми руками!» - кричит их командир. Попытка сопротивления заканчивается быстро - вас берут в плен, а раненого капитана добивают на месте.",
                choices: [],
                final: true,
                death: true,
                ending: "Гибель в западне"
            }
        };

        // Элементы DOM
        const sceneTitle = document.getElementById('scene-title');
        const sceneText = document.getElementById('scene-text');
        const choicesContainer = document.getElementById('choices-container');
        const trustValue = document.getElementById('trust-value');
        const trustMeter = document.getElementById('trust-meter');
        const angerValue = document.getElementById('anger-value');
        const angerMeter = document.getElementById('anger-meter');
        const honorValue = document.getElementById('honor-value');
        const honorMeter = document.getElementById('honor-meter');

        // Обновление статистики
        function updateStats() {
            trustValue.textContent = gameState.trust;
            trustMeter.style.width = `${gameState.trust}%`;
            
            angerValue.textContent = gameState.anger;
            angerMeter.style.width = `${gameState.anger}%`;
            
            honorValue.textContent = gameState.honor;
            honorMeter.style.width = `${gameState.honor}%`;
        }

        // Обработка выбора игрока
        function makeChoice(choice) {
            const scene = scenes[gameState.currentScene];
            const choiceObj = scene.choices[choice];
            
            // Применяем эффекты выбора
            if (choiceObj.effect) {
                if (choiceObj.effect.trust) gameState.trust = Math.max(0, Math.min(100, gameState.trust + choiceObj.effect.trust));
                if (choiceObj.effect.anger) gameState.anger = Math.max(0, Math.min(100, gameState.anger + choiceObj.effect.anger));
                if (choiceObj.effect.honor) gameState.honor = Math.max(0, Math.min(100, gameState.honor + choiceObj.effect.honor));
                if (choiceObj.effect.concessions) gameState.concessions += choiceObj.effect.concessions;
            }
            
            // Устанавливаем флаги
            if (choiceObj.setFlag) {
                gameState.flags[choiceObj.setFlag] = true;
            }
            
            // Переходим к следующей сцене
            gameState.currentScene = choiceObj.next;
            loadScene();
        }

        // Загрузка сцены
        function loadScene() {
            const scene = scenes[gameState.currentScene];
            
            // Проверяем, существует ли сцена
            if (!scene) {
        gameState.currentScene = "death_game_error";
        loadScene();  // Загружаем сцену с ошибкой
        return;
    }
            
            sceneTitle.textContent = scene.title;
            sceneText.textContent = scene.text;
            
            // Очищаем контейнер выбора
            choicesContainer.innerHTML = '';
            
            if (scene.final) {
                // Показываем финальный экран
                const finalHTML = `
                    <div class="final-container">
                        <div class="final-title">${scene.ending}</div>
                        <div class="final-text">${scene.text}</div>
                        <button class="restart-btn">Начать Заново</button>
                    </div>
                `;
                
                sceneText.innerHTML = finalHTML;
                
                // Добавляем обработчик для кнопки перезапуска
                const restartBtn = document.querySelector('.restart-btn');
                if (restartBtn) {
                    restartBtn.addEventListener('click', restartGame);
                }
                
                // Если это смерть, добавляем эффект
                if (scene.death) {
                    const deathOverlay = document.createElement('div');
                    deathOverlay.className = 'death-overlay';
                    deathOverlay.innerHTML = `
                        <div class="death-title">${scene.ending}</div>
                        <div class="death-text">${scene.text}</div>
                        <button class="restart-btn">Попробовать снова</button>
                    `;
                    document.body.appendChild(deathOverlay);
                    
                    deathOverlay.querySelector('.restart-btn').addEventListener('click', () => {
                        deathOverlay.remove();
                        restartGame();
                    });
                }
            } else {
                // Добавляем варианты выбора
                scene.choices.forEach((choice, index) => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    if (choice.text.includes("напасть") || choice.text.includes("убить") || choice.text.includes("Оскорбление")) {
                        button.classList.add('danger');
                    }
                    button.textContent = choice.text;
                    button.dataset.choice = index;
                    button.addEventListener('click', () => makeChoice(index));
                    choicesContainer.appendChild(button);
                });
            }
            
            updateStats();
        }

        // Перезапуск игры
        function restartGame() {
            // Удаляем оверлей смерти, если есть
            const deathOverlay = document.querySelector('.death-overlay');
            if (deathOverlay) deathOverlay.remove();
            
            // Сбрасываем состояние игры
            gameState.trust = 50;
            gameState.anger = 50;
            gameState.honor = 50;
            gameState.concessions = 0;
            gameState.currentScene = "start";
            gameState.flags = {
                insultedGuard: false,
                showedDocument: false,
                mentionedKingsPeace: false,
                offeredHostages: false,
                invokedFounders: false,
                revealedSecret: false,
                bribedCaptain: false,
                startedMutiny: false,
                sabotagedCamp: false
            };
            
            loadScene();
        }

        // Инициализация игры
        window.onload = function() {
            loadScene();
        };
    </script>
</body>
</html>
